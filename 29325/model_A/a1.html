<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Skyscraper Typing Game</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
    />
    <style>
      body {
        font-family: "Arial", sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        background-color: #f0f0f0;
        overflow: hidden;
      }
      #game-container {
        position: relative;
        width: 100%;
        max-width: 800px;
        text-align: center;
      }
      #skyscraper {
        width: 200px;
        margin: 20px auto;
        background: #ddd;
        border: 2px solid #000;
        position: relative;
      }
      .floor {
        height: 20px;
        background: #888;
        margin: 2px 0;
        transition: all 0.5s;
      }
      #sentence,
      #input,
      #progress,
      #score,
      #timer {
        margin: 10px 0;
      }
      #input {
        width: 80%;
        padding: 10px;
        font-size: 16px;
      }
      #progress {
        width: 80%;
        height: 20px;
        background: #e0e0e0;
        margin: auto;
      }
      #progress-bar {
        height: 100%;
        width: 100%;
        background: #4caf50;
        transition: width 0.1s linear;
      }
      #leaderboard {
        position: absolute;
        top: 10px;
        right: 10px;
        background: white;
        padding: 10px;
        border: 1px solid #ccc;
      }
    </style>
  </head>
  <body>
    <div id="game-container">
      <div id="leaderboard"></div>
      <div id="skyscraper"></div>
      <div id="sentence">Type this sentence to build!</div>
      <input
        type="text"
        id="input"
        autocomplete="off"
        placeholder="Start typing here..."
      />
      <div id="progress"><div id="progress-bar"></div></div>
      <div id="score">Floors: 0</div>
      <div id="timer">Time Left: 90s</div>
      <button onclick="resetGame()">Restart</button>
    </div>

    <script>
      const sentences = [
        "The quick brown fox jumps over the lazy dog.",
        "Programming can be fun with the right challenge.",
        "Skyscrapers touch the sky, much like dreams touch reality.",
        "Every new floor is a step towards the clouds.",
        "Type swiftly, build high, aim for the sky!",
      ];
      let currentSentence = "";
      let floors = 0;
      let gameTime = 90;
      let timer;
      let sentenceTimer;
      let boost = false;
      const skyscraper = document.getElementById("skyscraper");
      const input = document.getElementById("input");
      const progressBar = document.getElementById("progress-bar");
      const scoreDisplay = document.getElementById("score");
      const timerDisplay = document.getElementById("timer");
      const leaderboard = document.getElementById("leaderboard");

      function startGame() {
        currentSentence = getRandomSentence();
        document.getElementById("sentence").textContent = currentSentence;
        input.value = "";
        input.focus();
        startSentenceTimer();
        startMainTimer();
      }

      function getRandomSentence() {
        return sentences[Math.floor(Math.random() * sentences.length)];
      }

      function startSentenceTimer() {
        let timeLeft = 10;
        progressBar.style.width = "100%";
        sentenceTimer = setInterval(() => {
          timeLeft -= 0.1;
          progressBar.style.width = (timeLeft / 10) * 100 + "%";
          if (timeLeft <= 0) {
            clearInterval(sentenceTimer);
            handleSentenceEnd(false); // Time's up
          }
        }, 100);
      }

      function startMainTimer() {
        timer = setInterval(() => {
          gameTime--;
          timerDisplay.textContent = `Time Left: ${gameTime}s`;
          if (gameTime <= 0) {
            endGame();
          }
        }, 1000);
      }

      function handleSentenceEnd(isCorrect) {
        clearInterval(sentenceTimer);
        if (isCorrect) {
          addFloor();
          if (boost) {
            // Add boost effect here, like animation or visual effects
            skyscraper.lastChild.classList.add("animate__flash");
          }
          currentSentence = getRandomSentence();
          document.getElementById("sentence").textContent = currentSentence;
          startSentenceTimer();
        } else {
          // Misalignment or game over logic here
          if (floors > 0) {
            let lastFloor = skyscraper.lastChild;
            lastFloor.style.marginLeft = `${Math.random() > 0.5 ? "-" : ""}${
              Math.random() * 10
            }px`;
            if (Math.random() < 0.3) {
              // 30% chance to end game due to instability
              endGame();
            }
          }
        }
        input.value = "";
      }

      function addFloor() {
        const floor = document.createElement("div");
        floor.className = "floor";
        skyscraper.appendChild(floor);
        floors++;
        scoreDisplay.textContent = `Floors: ${floors}`;
        // Here you would update the background or add animations for height changes
      }

      function endGame() {
        clearInterval(timer);
        clearInterval(sentenceTimer);
        alert(`Game Over! You built ${floors} floors.`);
        // Add to leaderboard logic here
        updateLeaderboard("Player", floors);
      }

      function updateLeaderboard(name, score) {
        // This is a simple example. In a real scenario, you'd save this to a server.
        leaderboard.innerHTML += `<p>${name}: ${score}</p>`;
      }

      function resetGame() {
        clearInterval(timer);
        clearInterval(sentenceTimer);
        floors = 0;
        gameTime = 90;
        skyscraper.innerHTML = "";
        scoreDisplay.textContent = "Floors: 0";
        timerDisplay.textContent = "Time Left: 90s";
        startGame();
      }

      input.addEventListener("input", function () {
        if (input.value === currentSentence) {
          boost = parseInt(progressBar.style.width) > 50; // If more than 50% time left, it's a boost
          handleSentenceEnd(true);
        }
      });

      startGame();
    </script>
  </body>
</html>
